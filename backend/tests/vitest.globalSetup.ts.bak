import { setupIntegrationTestDatabase, teardownIntegrationTestDatabase } from './setupTestCleanup';
import { setTestPool } from './testPool'; // Import setTestPool
import { setPool as setDbPool } from '../src/db/index.js'; // Import setPool from db module (explicit .js extension)

let globalTestPool: any; // Store the pool globally for teardown

export async function setup() {
  console.log('Global Setup: Starting integration test database...');
  globalTestPool = await setupIntegrationTestDatabase();
  setTestPool(globalTestPool); // Set the global test pool
  setDbPool(globalTestPool); // Inject the test pool into the db module
  console.log('Global Setup: Integration test database started.');
  return () => {
    console.log('Global Teardown: Stopping integration test database...');
    teardownIntegrationTestDatabase(globalTestPool); // Pass the pool to teardown
    console.log('Global Teardown: Integration test database stopped.');
  };
}
